<!DOCTYPE html>
<!-- saved from url=(0047)http://127.0.0.1:3999/concurrency_in_go.slide#1 -->
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Concurrency in Go</title>

  <script>
    var notesEnabled = true;
  </script>
  <script src="./assets/slides.js"></script>


  <script>
    var sections = [{ "Number": [1], "Title": "Erin Stanfill", "Elem": [{ "URL": "portrait-2.jpg", "Width": 250, "Height": 313 }, { "URL": "truss_logo_grey.jpg", "Width": 0, "Height": 0 }, { "Lines": ["@elstanfill", "https://tinyels.github.io/presentations/"], "Pre": false }], "Notes": ["Hi, I am Erin Stanfill I've been writing software for a long time, but am fairly new to go. These days I am an engineer at Truss where we we help organizations build the infrastructure they need to deliver software reliably. Go is our preferred language for doing this work and its first class support for concurrency plays a large part in that preference.  I'm excited to get to talk to you about concurrency and go. I'll be posting links to some great references on twitter later today if you want to follow me, and these slides are in this github repo."], "Classes": null, "Styles": null }, { "Number": [2], "Title": "Agenda", "Elem": [{ "Bullet": ["what is concurrency", "mechanisms for writing concurrent programs in go", "common errors in concurrent programs"] }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [3], "Title": "Concurrency is the ability of different parts of a process to be executed out-of-order without affecting the final outcome", "Elem": null, "Notes": ["Let's use a real world example to talk about what this means and why we care. "], "Classes": null, "Styles": null }, { "Number": [4], "Title": "Nom nom", "Elem": null, "Notes": ["Let's bake a cake"], "Classes": ["background"], "Styles": ["background-image: url('tuxedo-cake.jpg')"] }, { "Number": [5], "Title": "Recipe", "Elem": [{ "URL": "fudgecake.jpg", "Width": 0, "Height": 0 }], "Notes": ["recipes are a type of program, right? We take input, perform operations, and produce a baked good."], "Classes": null, "Styles": null }, { "Number": [6], "Title": "Recipe", "Elem": [{ "URL": "sequential-cake-from-recipe.png", "Width": 0, "Height": 0 }], "Notes": ["here is a simplified diagram of the previous recipe, where I have made the steps that will take longer taller", "however I can rearrange some of the steps and it doesn't affect the cake."], "Classes": null, "Styles": null }, { "Number": [7], "Title": "Recipe", "Elem": [{ "URL": "sequential-cake.png", "Width": 0, "Height": 0 }], "Notes": ["I can preheat the oven first"], "Classes": null, "Styles": null }, { "Number": [8], "Title": "Recipe", "Elem": [{ "URL": "sequential-cake-reordered.png", "Width": 0, "Height": 0 }], "Notes": ["or I can have everything ready and then preheat the oven.", "honestly, I do this more often than I like", "Why does this irritate me? Because then I have to wait for it to preheat. This highlights something a little off from these diagrams.", "usually when we bake, we let the oven preheat while we prep."], "Classes": null, "Styles": null }, { "Number": [9], "Title": "Recipe ", "Elem": [{ "URL": "parallel-cake.png", "Width": 0, "Height": 0 }], "Notes": ["That is, we performs steps in parallel to save time. This parallelism is only possible because of concurrent nature of the process. "], "Classes": null, "Styles": null }, { "Number": [10], "Title": "Concurrency vs parallelism", "Elem": [{ "Bullet": ["concurrency is the composition of independently executing processes", "parallelism is the simultaneous execution of computations", "concurrency can enable parallelism"] }], "Notes": ["concurrency also enables having all of the parts of a meal ready at the same time"], "Classes": null, "Styles": null }, { "Number": [11], "Title": "Benefits of parallelism", "Elem": [{ "Bullet": ["can complete tasks in less time", "can use available resources more efficiently"] }], "Notes": ["in a kitchen parallel tasks mean we can prepare a meal faster."], "Classes": null, "Styles": null }, { "Number": [12], "Title": "Concurrency in Go", "Elem": null, "Notes": ["1. How to express a concurrent process in go", "2. How to set such a process up so that it runs in parallel", "The answer to these questions is why go is such a powerful language."], "Classes": null, "Styles": null }, { "Number": [13], "Title": "With Go, the developer should take care of concurrency; the Go runtime will take care of parallelism. ", "Elem": null, "Notes": null, "Classes": null, "Styles": null }, { "Number": [14], "Title": "Concurrency in Go", "Elem": [{ "Bullet": ["creating concurrent tasks (Goroutines)", "coordinating concurrent tasks", "messaging between concurrent tasks"] }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [15], "Title": "Goroutines", "Elem": [{ "Lines": ["Goroutines are functions that run concurrently with other functions."], "Pre": false }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [16], "Title": "Goroutines are not threads", "Elem": [{ "Bullet": ["many goroutines can be run on one thread", "the scheduler may move a goroutine to other threads", "goroutines use less memory and can start up faster"] }], "Notes": ["thread is the basic unit of cpu utilization, but when you write multithreaded code you have to manage the threads and the work on them. ", "goroutines are much cheaper", "the go scheduler multiplexes goroutines onto a set of threads. ", "That is many goroutines could be run within a thread (for instance context switching when blocked);", "and a goroutine can be moved to other threads (on other processors).", "There is a great talk about how go schedules work that just came out this week from GopherCon (see https://www.youtube.com/watch?v=YHRO5WQGh0k)"], "Classes": null, "Styles": null }, { "Number": [17], "Title": "Goroutine", "Elem": [{ "Lines": ["A function is run in a goroutine by prefacing the function call with the keyword \"go\"."], "Pre": false }, { "Lines": ["A sequential snippet of code"], "Pre": false }, { "Lines": ["preheat()\nbake() // doesn't start until preheat has finished"], "Pre": true }, { "Lines": ["It's concurrent implementation"], "Pre": false }, { "Lines": ["go preheat()\nbake() // doesn't wait for preheat to finish (or start!)"], "Pre": true }], "Notes": ["let's see some go concurrency in action"], "Classes": null, "Styles": null }, { "Number": [18], "Title": "A Serial Cake", "Elem": [{ "Text": "\n\n\n\u003cpre\u003e\u003cspan num=\"10\"\u003efunc wait(duration time.Duration) {\u003c/span\u003e\n\u003cspan num=\"11\"\u003e    time.Sleep(duration * time.Minute / pace)\u003c/span\u003e\n\u003cspan num=\"12\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": false, "Edit": false, "FileName": "x.go", "Ext": ".go", "Raw": "ZnVuYyB3YWl0KGR1cmF0aW9uIHRpbWUuRHVyYXRpb24pIHsKCXRpbWUuU2xlZXAoZHVyYXRpb24gKiB0aW1lLk1pbnV0ZSAvIHBhY2UpCn0K" }, { "Text": "\n\n\n\u003cpre\u003e\u003cspan num=\"13\"\u003efunc do(task string, duration time.Duration) {\u003c/span\u003e\n\u003cspan num=\"14\"\u003e    fmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\u003c/span\u003e\n\u003cspan num=\"15\"\u003e    wait(duration)\u003c/span\u003e\n\u003cspan num=\"16\"\u003e    fmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\u003c/span\u003e\n\u003cspan num=\"17\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": false, "Edit": false, "FileName": "x.go", "Ext": ".go", "Raw": "ZnVuYyBkbyh0YXNrIHN0cmluZywgZHVyYXRpb24gdGltZS5EdXJhdGlvbikgewoJZm10LlByaW50bG4oIj0+IiwgdGFzaykKCXdhaXQoZHVyYXRpb24pCglmbXQuUHJpbnRsbigiPD0iLCB0YXNrKQp9Cg==" }, { "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\n}\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"18\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"19\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"20\"\u003e    do(\u0026#34;preheat oven\u0026#34;, 18)\u003c/span\u003e\n\u003cspan num=\"21\"\u003e    do(\u0026#34;Grease pan\u0026#34;, 3)\u003c/span\u003e\n\u003cspan num=\"22\"\u003e    do(\u0026#34;mix ingredients\u0026#34;, 15)\u003c/span\u003e\n\u003cspan num=\"23\"\u003e    do(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"24\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003cspan num=\"25\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "x.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJc3RhcnQgOj0gdGltZS5Ob3coKQoJZG8oInByZWhlYXQgb3ZlbiIsIDE4KQoJZG8oIkdyZWFzZSBwYW4iLCAzKQoJZG8oIm1peCBpbmdyZWRpZW50cyIsIDE1KQoJZG8oImJha2UiLCAzMCkKCWZtdC5QcmludGxuKCJiYWtpbmcgdG9vayIsICh0aW1lLlNpbmNlKHN0YXJ0KSAqIHBhY2UpKQp9Cg==" }], "Notes": ["first of all the serial implementation"], "Classes": null, "Styles": null }, { "Number": [19], "Title": "A Concurrent Cake", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\n}\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"18\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"19\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"20\"\u003e    \u003cb\u003ego do(\u0026#34;preheat oven\u0026#34;, 18)\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"21\"\u003e    do(\u0026#34;Grease pan\u0026#34;, 3)      \u003c/span\u003e\n\u003cspan num=\"22\"\u003e    do(\u0026#34;mix ingredients\u0026#34;, 15)\u003c/span\u003e\n\u003cspan num=\"23\"\u003e    do(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"24\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003cspan num=\"25\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "x2.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJc3RhcnQgOj0gdGltZS5Ob3coKQoJZ28gZG8oInByZWhlYXQgb3ZlbiIsIDE4KSAvLyBITAoJZG8oIkdyZWFzZSBwYW4iLCAzKSAgICAgICAvLyBITHh4eAoJZG8oIm1peCBpbmdyZWRpZW50cyIsIDE1KSAvLyBITHh4eAoJZG8oImJha2UiLCAzMCkKCWZtdC5QcmludGxuKCJiYWtpbmcgdG9vayIsICh0aW1lLlNpbmNlKHN0YXJ0KSAqIHBhY2UpKQp9Cg==" }], "Notes": ["a dash of concurrency!", "we saved 20 minutes in the kitchen!"], "Classes": null, "Styles": null }, { "Number": [20], "Title": "Race conditions", "Elem": [{ "URL": "raceCondition.png", "Width": 0, "Height": 0 }], "Notes": ["A race condition occurs when the output is dependent on the sequence or timing of other uncontrollable events", "https://golang.org/doc/articles/race_detector.html"], "Classes": null, "Styles": null }, { "Number": [21], "Title": "Bake off", "Elem": null, "Notes": ["lets have a bake off"], "Classes": ["background"], "Styles": ["background-image: url('bakeoff.png')"] }, { "Number": [22], "Title": "Bake!", "Elem": [{ "Text": "\n\n\n\u003cpre\u003e\u003cspan num=\"18\"\u003efunc bakeCake(baker string) {\u003c/span\u003e\n\u003cspan num=\"19\"\u003e    fmt.Println(baker, \u0026#34;is starting\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"20\"\u003e    go do(\u0026#34;preheat oven\u0026#34;, 18, baker)\u003c/span\u003e\n\u003cspan num=\"21\"\u003e    do(\u0026#34;Grease pan\u0026#34;, 3, baker)\u003c/span\u003e\n\u003cspan num=\"22\"\u003e    do(\u0026#34;mix ingredients\u0026#34;, 15, baker)\u003c/span\u003e\n\u003cspan num=\"23\"\u003e    do(\u0026#34;bake\u0026#34;, 30, baker)\u003c/span\u003e\n\u003cspan num=\"24\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": false, "Edit": false, "FileName": "bakeoff.go", "Ext": ".go", "Raw": "ZnVuYyBiYWtlQ2FrZShiYWtlciBzdHJpbmcpIHsKCWZtdC5QcmludGxuKGJha2VyLCAiaXMgc3RhcnRpbmciKQoJZ28gZG8oInByZWhlYXQgb3ZlbiIsIDE4LCBiYWtlcikKCWRvKCJHcmVhc2UgcGFuIiwgMywgYmFrZXIpCglkbygibWl4IGluZ3JlZGllbnRzIiwgMTUsIGJha2VyKQoJZG8oImJha2UiLCAzMCwgYmFrZXIpCn0K" }, { "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\nfunc do(task string, duration time.Duration, baker string) {\n\tfmt.Println(baker, \u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(baker, \u0026#34;\u0026lt;=\u0026#34;, task)\n}\nfunc bakeCake(baker string) {\n\tfmt.Println(baker, \u0026#34;is starting\u0026#34;)\n\tgo do(\u0026#34;preheat oven\u0026#34;, 18, baker)\n\tdo(\u0026#34;Grease pan\u0026#34;, 3, baker)\n\tdo(\u0026#34;mix ingredients\u0026#34;, 15, baker)\n\tdo(\u0026#34;bake\u0026#34;, 30, baker)\n}\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"25\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"26\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"27\"\u003e    go bakeCake(\u0026#34;Nancy\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"28\"\u003e    go bakeCake(\u0026#34;Luis\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"29\"\u003e    go bakeCake(\u0026#34;Martha\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"30\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003cspan num=\"31\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "bakeoff.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJc3RhcnQgOj0gdGltZS5Ob3coKQoJZ28gYmFrZUNha2UoIk5hbmN5IikKCWdvIGJha2VDYWtlKCJMdWlzIikKCWdvIGJha2VDYWtlKCJNYXJ0aGEiKQoJZm10LlByaW50bG4oImJha2luZyB0b29rIiwgKHRpbWUuU2luY2Uoc3RhcnQpICogcGFjZSkpCn0K" }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [23], "Title": "What just happened?", "Elem": null, "Notes": null, "Classes": null, "Styles": null }, { "Number": [24], "Title": "main vs goroutines", "Elem": [{ "URL": "bake-off.png", "Width": 950, "Height": 403 }], "Notes": ["to prevent this we need some way of coordinating the goroutines"], "Classes": null, "Styles": null }, { "Number": [25], "Title": "coordination of goroutines", "Elem": [{ "Bullet": ["WaitGroups", "Mutex", "Channels"] }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [26], "Title": "WaitGroup", "Elem": [{ "Lines": ["A WaitGroup waits for a collection of goroutines to finish. The main goroutine calls Add to set the number of goroutines to wait for. Then each of the goroutines runs and calls Done when finished. At the same time, Wait can be used to block until all goroutines have finished."], "Pre": false }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [27], "Title": "Waiting with a WaitGroup", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;sync\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\nfunc do(task string, duration time.Duration, baker string) {\n\tfmt.Println(baker, \u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(baker, \u0026#34;\u0026lt;=\u0026#34;, task)\n}\nfunc bakeCake(baker string) {\n\tfmt.Println(baker, \u0026#34;is starting\u0026#34;)\n\tgo do(\u0026#34;preheat oven\u0026#34;, 18, baker)\n\tdo(\u0026#34;Grease pan\u0026#34;, 3, baker)\n\tdo(\u0026#34;mix ingredients\u0026#34;, 15, baker)\n\tdo(\u0026#34;bake\u0026#34;, 30, baker)\n}\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"26\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"27\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"28\"\u003e    \u003cb\u003evar wg sync.WaitGroup\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"29\"\u003e    \u003cb\u003ewg.Add(3)\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"30\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"31\"\u003e        bakeCake(\u0026#34;Nancy\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"32\"\u003e        \u003cb\u003ewg.Done()\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"33\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"34\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"35\"\u003e        bakeCake(\u0026#34;Luis\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"36\"\u003e        \u003cb\u003ewg.Done()\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"37\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"38\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"39\"\u003e        bakeCake(\u0026#34;Martha\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"40\"\u003e        \u003cb\u003ewg.Done()\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"41\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"42\"\u003e    \u003cb\u003ewg.Wait()\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"43\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003cspan num=\"44\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "bakeoff.1.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJc3RhcnQgOj0gdGltZS5Ob3coKQoJdmFyIHdnIHN5bmMuV2FpdEdyb3VwIC8vIEhMCgl3Zy5BZGQoMykgICAgICAgICAgICAgLy8gSEwKCWdvIGZ1bmMoKSB7CgkJYmFrZUNha2UoIk5hbmN5IikKCQl3Zy5Eb25lKCkgLy8gSEwKCX0oKQoJZ28gZnVuYygpIHsKCQliYWtlQ2FrZSgiTHVpcyIpCgkJd2cuRG9uZSgpIC8vIEhMCgl9KCkKCWdvIGZ1bmMoKSB7CgkJYmFrZUNha2UoIk1hcnRoYSIpCgkJd2cuRG9uZSgpIC8vIEhMCgl9KCkKCXdnLldhaXQoKSAvLyBITAoJZm10LlByaW50bG4oImJha2luZyB0b29rIiwgKHRpbWUuU2luY2Uoc3RhcnQpICogcGFjZSkpCn0K" }], "Notes": ["explain function literal"], "Classes": null, "Styles": null }, { "Number": [28], "Title": "Be careful with loops and lambdas", "Elem": [{ "Lines": ["Variables declared in for loops are passed by reference"], "Pre": false }, { "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;sync\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\nfunc do(task string, duration time.Duration, baker string) {\n\tfmt.Println(baker, \u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(baker, \u0026#34;\u0026lt;=\u0026#34;, task)\n}\nfunc bakeCake(baker string) {\n\tfmt.Println(baker, \u0026#34;is starting\u0026#34;)\n\tgo do(\u0026#34;preheat oven\u0026#34;, 18, baker)\n\tdo(\u0026#34;Grease pan\u0026#34;, 3, baker)\n\tdo(\u0026#34;mix ingredients\u0026#34;, 15, baker)\n\tdo(\u0026#34;bake\u0026#34;, 30, baker)\n}\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"26\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"27\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"28\"\u003e    bakers := []string{\u0026#34;Nancy\u0026#34;, \u0026#34;Luis\u0026#34;, \u0026#34;Richard\u0026#34;, \u0026#34;Chetna\u0026#34;, \u0026#34;Martha\u0026#34;}\u003c/span\u003e\n\u003cspan num=\"29\"\u003e    var wg sync.WaitGroup\u003c/span\u003e\n\u003cspan num=\"30\"\u003e    wg.Add(len(bakers))\u003c/span\u003e\n\u003cspan num=\"31\"\u003e    for _, baker := range bakers {\u003c/span\u003e\n\u003cspan num=\"32\"\u003e        go func() {\u003c/span\u003e\n\u003cspan num=\"33\"\u003e            bakeCake(baker)\u003c/span\u003e\n\u003cspan num=\"34\"\u003e            wg.Done()\u003c/span\u003e\n\u003cspan num=\"35\"\u003e        }()\u003c/span\u003e\n\u003cspan num=\"36\"\u003e    }\u003c/span\u003e\n\u003cspan num=\"37\"\u003e    wg.Wait()\u003c/span\u003e\n\u003cspan num=\"38\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003cspan num=\"39\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "bakeoff.2.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJc3RhcnQgOj0gdGltZS5Ob3coKQoJYmFrZXJzIDo9IFtdc3RyaW5neyJOYW5jeSIsICJMdWlzIiwgIlJpY2hhcmQiLCAiQ2hldG5hIiwgIk1hcnRoYSJ9Cgl2YXIgd2cgc3luYy5XYWl0R3JvdXAKCXdnLkFkZChsZW4oYmFrZXJzKSkKCWZvciBfLCBiYWtlciA6PSByYW5nZSBiYWtlcnMgewoJCWdvIGZ1bmMoKSB7CgkJCWJha2VDYWtlKGJha2VyKQoJCQl3Zy5Eb25lKCkKCQl9KCkKCX0KCXdnLldhaXQoKQoJZm10LlByaW50bG4oImJha2luZyB0b29rIiwgKHRpbWUuU2luY2Uoc3RhcnQpICogcGFjZSkpCn0K" }], "Notes": ["When you declare a new variable inside of a for loop, it is important to remember that the variables aren’t being redeclared with each iteration. Instead the variable is the same, but instead the value that is stored in the variable is being updated.", "this is a race condition ( show tool?)"], "Classes": null, "Styles": null }, { "Number": [29], "Title": "loops and lambdas, con't", "Elem": [{ "Lines": ["function parameters in Go are passed by value"], "Pre": false }, { "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;sync\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\nfunc do(task string, duration time.Duration, baker string) {\n\tfmt.Println(baker, \u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(baker, \u0026#34;\u0026lt;=\u0026#34;, task)\n}\nfunc bakeCake(baker string) {\n\tfmt.Println(baker, \u0026#34;is starting\u0026#34;)\n\tgo do(\u0026#34;preheat oven\u0026#34;, 18, baker)\n\tdo(\u0026#34;Grease pan\u0026#34;, 3, baker)\n\tdo(\u0026#34;mix ingredients\u0026#34;, 15, baker)\n\tdo(\u0026#34;bake\u0026#34;, 30, baker)\n}\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"26\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"27\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"28\"\u003e    bakers := []string{\u0026#34;Nancy\u0026#34;, \u0026#34;Luis\u0026#34;, \u0026#34;Richard\u0026#34;, \u0026#34;Chetna\u0026#34;, \u0026#34;Martha\u0026#34;}\u003c/span\u003e\n\u003cspan num=\"29\"\u003e    var wg sync.WaitGroup\u003c/span\u003e\n\u003cspan num=\"30\"\u003e    wg.Add(len(bakers))\u003c/span\u003e\n\u003cspan num=\"31\"\u003e    for _, baker := range bakers {\u003c/span\u003e\n\u003cspan num=\"32\"\u003e        \u003cb\u003ego func(b string) {\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"33\"\u003e            \u003cb\u003ebakeCake(b)\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"34\"\u003e            wg.Done()\u003c/span\u003e\n\u003cspan num=\"35\"\u003e        \u003cb\u003e}(baker)\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"36\"\u003e    }\u003c/span\u003e\n\u003cspan num=\"37\"\u003e    wg.Wait()\u003c/span\u003e\n\u003cspan num=\"38\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003cspan num=\"39\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "bakeoff.3.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJc3RhcnQgOj0gdGltZS5Ob3coKQoJYmFrZXJzIDo9IFtdc3RyaW5neyJOYW5jeSIsICJMdWlzIiwgIlJpY2hhcmQiLCAiQ2hldG5hIiwgIk1hcnRoYSJ9Cgl2YXIgd2cgc3luYy5XYWl0R3JvdXAKCXdnLkFkZChsZW4oYmFrZXJzKSkKCWZvciBfLCBiYWtlciA6PSByYW5nZSBiYWtlcnMgewoJCWdvIGZ1bmMoYiBzdHJpbmcpIHsgLy8gSEwKCQkJYmFrZUNha2UoYikgLy8gSEwKCQkJd2cuRG9uZSgpCgkJfShiYWtlcikgLy8gSEwKCX0KCXdnLldhaXQoKQoJZm10LlByaW50bG4oImJha2luZyB0b29rIiwgKHRpbWUuU2luY2Uoc3RhcnQpICogcGFjZSkpCn0K" }], "Notes": ["If we modify the previous lambda so that it takes a parameter, we can ensure that the goroutine runs with the value it had at time of composition"], "Classes": null, "Styles": null }, { "Number": [30], "Title": "Serendipity", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\n}\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre contenteditable=\"true\" spellcheck=\"false\"\u003e\u003cspan num=\"18\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"19\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"20\"\u003e    go do(\u0026#34;preheat oven\u0026#34;, 18)\u003c/span\u003e\n\u003cspan num=\"21\"\u003e    \u003cb\u003edo(\u0026#34;Grease pan\u0026#34;, 3)\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"22\"\u003e    \u003cb\u003edo(\u0026#34;mix ingredients\u0026#34;, 15)\u003c/b\u003e\u003c/span\u003e\n\u003cspan num=\"23\"\u003e    do(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"24\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003cspan num=\"25\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": true, "FileName": "x2.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJc3RhcnQgOj0gdGltZS5Ob3coKQoJZ28gZG8oInByZWhlYXQgb3ZlbiIsIDE4KSAvLyBITAoJZG8oIkdyZWFzZSBwYW4iLCAzKSAgICAgICAvLyBITHh4eAoJZG8oIm1peCBpbmdyZWRpZW50cyIsIDE1KSAvLyBITHh4eAoJZG8oImJha2UiLCAzMCkKCWZtdC5QcmludGxuKCJiYWtpbmcgdG9vayIsICh0aW1lLlNpbmNlKHN0YXJ0KSAqIHBhY2UpKQp9Cg==" }], "Notes": ["let's return to our original baking.", "what happens if a partner greases the pan? (go line 21)", "what happens if I can mix faster? (change time)", "we have some race conditions here hidden by magical timing", "so how do we prevent this?"], "Classes": null, "Styles": null }, { "Number": [31], "Title": "Hot oven, do not touch!", "Elem": null, "Notes": ["exclusive use of oven is needed for preheat and bake"], "Classes": ["background"], "Styles": ["background-image: url('oven.jpg')"] }, { "Number": [32], "Title": "Locks", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;sync\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\n\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\n}\n\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre contenteditable=\"true\" spellcheck=\"false\"\u003e\u003cspan num=\"22\"\u003evar oven sync.Mutex\u003c/span\u003e\n\u003cspan num=\"23\"\u003e\u003c/span\u003e\n\u003cspan num=\"24\"\u003efunc useOven(task string, duration time.Duration) {\u003c/span\u003e\n\u003cspan num=\"25\"\u003e    oven.Lock()\u003c/span\u003e\n\u003cspan num=\"26\"\u003e    do(task, duration)\u003c/span\u003e\n\u003cspan num=\"27\"\u003e    oven.Unlock()\u003c/span\u003e\n\u003cspan num=\"28\"\u003e}\u003c/span\u003e\n\u003cspan num=\"29\"\u003e\u003c/span\u003e\n\u003cspan num=\"30\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"31\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"32\"\u003e    go useOven(\u0026#34;preheat oven\u0026#34;, 18)\u003c/span\u003e\n\u003cspan num=\"33\"\u003e    do(\u0026#34;Grease pan\u0026#34;, 3)\u003c/span\u003e\n\u003cspan num=\"34\"\u003e    do(\u0026#34;mix ingredients\u0026#34;, 15)\u003c/span\u003e\n\u003cspan num=\"35\"\u003e    useOven(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"36\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003cspan num=\"37\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": true, "FileName": "lock.go", "Ext": ".go", "Raw": "dmFyIG92ZW4gc3luYy5NdXRleAoKZnVuYyB1c2VPdmVuKHRhc2sgc3RyaW5nLCBkdXJhdGlvbiB0aW1lLkR1cmF0aW9uKSB7CglvdmVuLkxvY2soKQoJZG8odGFzaywgZHVyYXRpb24pCglvdmVuLlVubG9jaygpCn0KCmZ1bmMgbWFpbigpIHsKCXN0YXJ0IDo9IHRpbWUuTm93KCkKCWdvIHVzZU92ZW4oInByZWhlYXQgb3ZlbiIsIDE4KQoJZG8oIkdyZWFzZSBwYW4iLCAzKQoJZG8oIm1peCBpbmdyZWRpZW50cyIsIDE1KQoJdXNlT3ZlbigiYmFrZSIsIDMwKQoJZm10LlByaW50bG4oImJha2luZyB0b29rIiwgKHRpbWUuU2luY2Uoc3RhcnQpICogcGFjZSkpCn0K" }], "Notes": ["what happens if change times", "what happens if move more things into Goroutines", "how do we make sure that the cake is mixed before it is put in oven? (another lock?)", "exclusive use of ingredients is needed for mix and bake"], "Classes": null, "Styles": null }, { "Number": [33], "Title": "Channels", "Elem": [{ "Lines": ["Channels are how goroutines communicate with one another"], "Pre": false }, { "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n)\n\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"7\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"9\"\u003e    messages := make(chan string)\u003c/span\u003e\n\u003cspan num=\"10\"\u003e\u003c/span\u003e\n\u003cspan num=\"11\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"12\"\u003e        //sending data\u003c/span\u003e\n\u003cspan num=\"13\"\u003e        messages \u0026lt;- \u0026#34;toast is ready\u0026#34;\u003c/span\u003e\n\u003cspan num=\"14\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"15\"\u003e\u003c/span\u003e\n\u003cspan num=\"16\"\u003e    //receiving data\u003c/span\u003e\n\u003cspan num=\"17\"\u003e    var msg = \u0026lt;-messages\u003c/span\u003e\n\u003cspan num=\"18\"\u003e    fmt.Println(msg)\u003c/span\u003e\n\u003cspan num=\"20\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "toast.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJbWVzc2FnZXMgOj0gbWFrZShjaGFuIHN0cmluZykKCglnbyBmdW5jKCkgewoJCS8vc2VuZGluZyBkYXRhCgkJbWVzc2FnZXMgPC0gInRvYXN0IGlzIHJlYWR5IgoJfSgpCgoJLy9yZWNlaXZpbmcgZGF0YQoJdmFyIG1zZyA9IDwtbWVzc2FnZXMKCWZtdC5QcmludGxuKG1zZykKfQo=" }], "Notes": ["You can send values into channels from one goroutine and receive those values into another goroutine.", "receiver blocks Waiting"], "Classes": null, "Styles": null }, { "Number": [34], "Title": "coordinating with channels", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;sync\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\n\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\n}\n\nfunc main() {\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre contenteditable=\"true\" spellcheck=\"false\"\u003e\u003cspan num=\"23\"\u003e    start := time.Now()\u003c/span\u003e\n\u003cspan num=\"24\"\u003e    var wg sync.WaitGroup\u003c/span\u003e\n\u003cspan num=\"25\"\u003e    wg.Add(1)\u003c/span\u003e\n\u003cspan num=\"26\"\u003e    heat := make(chan bool)\u003c/span\u003e\n\u003cspan num=\"27\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"28\"\u003e        do(\u0026#34;preheat\u0026#34;, 18)\u003c/span\u003e\n\u003cspan num=\"29\"\u003e        heat \u0026lt;- true\u003c/span\u003e\n\u003cspan num=\"30\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"31\"\u003e    go do(\u0026#34;grease pan\u0026#34;, 3)\u003c/span\u003e\n\u003cspan num=\"32\"\u003e    go do(\u0026#34;mix ingredients\u0026#34;, 15)\u003c/span\u003e\n\u003cspan num=\"33\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"34\"\u003e        \u0026lt;-heat\u003c/span\u003e\n\u003cspan num=\"35\"\u003e        do(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"36\"\u003e        wg.Done()\u003c/span\u003e\n\u003cspan num=\"37\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"38\"\u003e\u003c/span\u003e\n\u003cspan num=\"39\"\u003e    wg.Wait()\u003c/span\u003e\n\u003cspan num=\"40\"\u003e    fmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\u003c/span\u003e\n\u003c/pre\u003e\n\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/pre\u003e\n", "Play": true, "Edit": true, "FileName": "channel.go", "Ext": ".go", "Raw": "CXN0YXJ0IDo9IHRpbWUuTm93KCkKCXZhciB3ZyBzeW5jLldhaXRHcm91cAoJd2cuQWRkKDEpCgloZWF0IDo9IG1ha2UoY2hhbiBib29sKQoJZ28gZnVuYygpIHsKCQlkbygicHJlaGVhdCIsIDE4KQoJCWhlYXQgPC0gdHJ1ZQoJfSgpCglnbyBkbygiZ3JlYXNlIHBhbiIsIDMpCglnbyBkbygibWl4IGluZ3JlZGllbnRzIiwgMTUpCglnbyBmdW5jKCkgewoJCTwtaGVhdAoJCWRvKCJiYWtlIiwgMzApCgkJd2cuRG9uZSgpCgl9KCkKCgl3Zy5XYWl0KCkKCWZtdC5QcmludGxuKCJiYWtpbmcgdG9vayIsICh0aW1lLlNpbmNlKHN0YXJ0KSAqIHBhY2UpKQo=" }], "Notes": ["sends and receives block until both the sender and receiver are ready.", "what happens if mixing ingredients takes too long?"], "Classes": null, "Styles": null }, { "Number": [35], "Title": "more conditions", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;sync\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\ttime.Sleep(duration * time.Minute / pace)\n}\n\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\n}\n\nfunc main() {\n\tstart := time.Now()\n\tvar wg sync.WaitGroup\n\twg.Add(1)\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre contenteditable=\"true\" spellcheck=\"false\"\u003e\u003cspan num=\"26\"\u003e    heat := make(chan bool)\u003c/span\u003e\n\u003cspan num=\"27\"\u003e    batter := make(chan bool)\u003c/span\u003e\n\u003cspan num=\"28\"\u003e    pan := make(chan bool)\u003c/span\u003e\n\u003cspan num=\"29\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"30\"\u003e        \u0026lt;-heat\u003c/span\u003e\n\u003cspan num=\"31\"\u003e        \u0026lt;-batter\u003c/span\u003e\n\u003cspan num=\"32\"\u003e        \u0026lt;-pan\u003c/span\u003e\n\u003cspan num=\"33\"\u003e        do(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"34\"\u003e        wg.Done()\u003c/span\u003e\n\u003cspan num=\"35\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"36\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"37\"\u003e        do(\u0026#34;preheat\u0026#34;, 18)\u003c/span\u003e\n\u003cspan num=\"38\"\u003e        heat \u0026lt;- true\u003c/span\u003e\n\u003cspan num=\"39\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"40\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"41\"\u003e        do(\u0026#34;grease pan\u0026#34;, 3)\u003c/span\u003e\n\u003cspan num=\"42\"\u003e        pan \u0026lt;- true\u003c/span\u003e\n\u003cspan num=\"43\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"44\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"45\"\u003e        do(\u0026#34;mix ingredients\u0026#34;, 15)\u003c/span\u003e\n\u003cspan num=\"46\"\u003e        batter \u0026lt;- true\u003c/span\u003e\n\u003cspan num=\"47\"\u003e    }()\u003c/span\u003e\n\u003c/pre\u003e\n\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003e\twg.Wait()\n\tfmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\n}\n\u003c/span\u003e\u003c/pre\u003e\n", "Play": true, "Edit": true, "FileName": "channel.1.go", "Ext": ".go", "Raw": "CWhlYXQgOj0gbWFrZShjaGFuIGJvb2wpCgliYXR0ZXIgOj0gbWFrZShjaGFuIGJvb2wpCglwYW4gOj0gbWFrZShjaGFuIGJvb2wpCglnbyBmdW5jKCkgewoJCTwtaGVhdAoJCTwtYmF0dGVyCgkJPC1wYW4KCQlkbygiYmFrZSIsIDMwKQoJCXdnLkRvbmUoKQoJfSgpCglnbyBmdW5jKCkgewoJCWRvKCJwcmVoZWF0IiwgMTgpCgkJaGVhdCA8LSB0cnVlCgl9KCkKCWdvIGZ1bmMoKSB7CgkJZG8oImdyZWFzZSBwYW4iLCAzKQoJCXBhbiA8LSB0cnVlCgl9KCkKCWdvIGZ1bmMoKSB7CgkJZG8oIm1peCBpbmdyZWRpZW50cyIsIDE1KQoJCWJhdHRlciA8LSB0cnVlCgl9KCkK" }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [36], "Title": "waiting on cake", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;runtime\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\truntime.Gosched() // yield to another goroutine\n\ttime.Sleep(duration * time.Minute / pace)\n}\n\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\n}\n\nfunc main() {\n\tstart := time.Now()\n\tbatter := make(chan bool)\n\tpan := make(chan bool)\n\theat := make(chan int)\n\tgo func() {\n\t\tdo(\u0026#34;preheat\u0026#34;, 18)\n\t\theat \u0026lt;- 350\n\t}()\n\tgo func() {\n\t\tdo(\u0026#34;grease pan\u0026#34;, 3)\n\t\tpan \u0026lt;- true\n\t}()\n\tgo func() {\n\t\tdo(\u0026#34;mix ingredients\u0026#34;, 15)\n\t\tbatter \u0026lt;- true\n\t}()\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"40\"\u003e    cake := make(chan string)\u003c/span\u003e\n\u003cspan num=\"41\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"42\"\u003e        \u0026lt;-heat\u003c/span\u003e\n\u003cspan num=\"43\"\u003e        \u0026lt;-batter\u003c/span\u003e\n\u003cspan num=\"44\"\u003e        \u0026lt;-pan\u003c/span\u003e\n\u003cspan num=\"45\"\u003e        do(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"46\"\u003e        cake \u0026lt;- \u0026#34;fudge cake is ready\u0026#34;\u003c/span\u003e\n\u003cspan num=\"47\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"48\"\u003e    fmt.Println(\u0026lt;-cake)\u003c/span\u003e\n\u003c/pre\u003e\n\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003e\tfmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\n}\n\u003c/span\u003e\u003c/pre\u003e\n", "Play": true, "Edit": false, "FileName": "channel.3.go", "Ext": ".go", "Raw": "CWNha2UgOj0gbWFrZShjaGFuIHN0cmluZykKCWdvIGZ1bmMoKSB7CgkJPC1oZWF0CgkJPC1iYXR0ZXIKCQk8LXBhbgoJCWRvKCJiYWtlIiwgMzApCgkJY2FrZSA8LSAiZnVkZ2UgY2FrZSBpcyByZWFkeSIKCX0oKQoJZm10LlByaW50bG4oPC1jYWtlKQo=" }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [37], "Title": "handling received data", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;runtime\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\truntime.Gosched() // yield to another goroutine\n\ttime.Sleep(duration * time.Minute / pace)\n}\n\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n\tfmt.Println(\u0026#34;\u0026lt;=\u0026#34;, task)\n}\n\nfunc main() {\n\tstart := time.Now()\n\tbatter := make(chan bool)\n\tpan := make(chan bool)\n\theat := make(chan int)\n\tgo func() {\n\t\tdo(\u0026#34;preheat\u0026#34;, 18)\n\t\theat \u0026lt;- 350\n\t}()\n\tgo func() {\n\t\tdo(\u0026#34;grease pan\u0026#34;, 3)\n\t\tpan \u0026lt;- true\n\t}()\n\tgo func() {\n\t\tdo(\u0026#34;mix ingredients\u0026#34;, 15)\n\t\tbatter \u0026lt;- true\n\t}()\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"40\"\u003e    cake := make(chan string)\u003c/span\u003e\n\u003cspan num=\"41\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"42\"\u003e        msg1 := \u0026lt;-heat\u003c/span\u003e\n\u003cspan num=\"43\"\u003e        fmt.Println(\u0026#34;temp is\u0026#34;, msg1)\u003c/span\u003e\n\u003cspan num=\"44\"\u003e        \u0026lt;-batter\u003c/span\u003e\n\u003cspan num=\"45\"\u003e        fmt.Println(\u0026#34;batter is ready\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"46\"\u003e        \u0026lt;-pan\u003c/span\u003e\n\u003cspan num=\"47\"\u003e        fmt.Println(\u0026#34;pan is ready\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"48\"\u003e        do(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"49\"\u003e        cake \u0026lt;- \u0026#34;fudge cake is ready\u0026#34;\u003c/span\u003e\n\u003cspan num=\"50\"\u003e    }()\u003c/span\u003e\n\u003cspan num=\"51\"\u003e    fmt.Println(\u0026lt;-cake)\u003c/span\u003e\n\u003c/pre\u003e\n\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003e\tfmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\n}\n\u003c/span\u003e\u003c/pre\u003e\n", "Play": true, "Edit": false, "FileName": "channel.4.go", "Ext": ".go", "Raw": "CWNha2UgOj0gbWFrZShjaGFuIHN0cmluZykKCWdvIGZ1bmMoKSB7CgkJbXNnMSA6PSA8LWhlYXQKCQlmbXQuUHJpbnRsbigidGVtcCBpcyIsIG1zZzEpCgkJPC1iYXR0ZXIKCQlmbXQuUHJpbnRsbigiYmF0dGVyIGlzIHJlYWR5IikKCQk8LXBhbgoJCWZtdC5QcmludGxuKCJwYW4gaXMgcmVhZHkiKQoJCWRvKCJiYWtlIiwgMzApCgkJY2FrZSA8LSAiZnVkZ2UgY2FrZSBpcyByZWFkeSIKCX0oKQoJZm10LlByaW50bG4oPC1jYWtlKQo=" }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [38], "Title": "Range ", "Elem": [{ "Text": "\n\n\n\u003cpre\u003e\u003cspan num=\"8\"\u003efunc makeCakeAndSend(cs chan string, count int) {\u003c/span\u003e\n\u003cspan num=\"9\"\u003e    for i := 1; i \u0026lt;= count; i\u0026#43;\u0026#43; {\u003c/span\u003e\n\u003cspan num=\"10\"\u003e        cakeName := \u0026#34;Strawberry Cake \u0026#34; \u0026#43; strconv.Itoa(i)\u003c/span\u003e\n\u003cspan num=\"11\"\u003e        cs \u0026lt;- cakeName //send a strawberry cake\u003c/span\u003e\n\u003cspan num=\"12\"\u003e    }\u003c/span\u003e\n\u003cspan num=\"13\"\u003e    close(cs)\u003c/span\u003e\n\u003cspan num=\"14\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": false, "Edit": false, "FileName": "range.go", "Ext": ".go", "Raw": "ZnVuYyBtYWtlQ2FrZUFuZFNlbmQoY3MgY2hhbiBzdHJpbmcsIGNvdW50IGludCkgewoJZm9yIGkgOj0gMTsgaSA8PSBjb3VudDsgaSsrIHsKCQljYWtlTmFtZSA6PSAiU3RyYXdiZXJyeSBDYWtlICIgKyBzdHJjb252Lkl0b2EoaSkKCQljcyA8LSBjYWtlTmFtZSAvL3NlbmQgYSBzdHJhd2JlcnJ5IGNha2UKCX0KCWNsb3NlKGNzKQp9Cg==" }, { "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;strconv\u0026#34;\n)\n\nfunc makeCakeAndSend(cs chan string, count int) {\n\tfor i := 1; i \u0026lt;= count; i\u0026#43;\u0026#43; {\n\t\tcakeName := \u0026#34;Strawberry Cake \u0026#34; \u0026#43; strconv.Itoa(i)\n\t\tcs \u0026lt;- cakeName //send a strawberry cake\n\t}\n\tclose(cs)\n}\n\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"16\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"17\"\u003e    cs := make(chan string)\u003c/span\u003e\n\u003cspan num=\"18\"\u003e    go makeCakeAndSend(cs, 5)\u003c/span\u003e\n\u003cspan num=\"19\"\u003e    for s := range cs {\u003c/span\u003e\n\u003cspan num=\"20\"\u003e        fmt.Println(\u0026#34;Packing received cake: \u0026#34;, s)\u003c/span\u003e\n\u003cspan num=\"21\"\u003e    }\u003c/span\u003e\n\u003cspan num=\"22\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "range.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJY3MgOj0gbWFrZShjaGFuIHN0cmluZykKCWdvIG1ha2VDYWtlQW5kU2VuZChjcywgNSkKCWZvciBzIDo9IHJhbmdlIGNzIHsKCQlmbXQuUHJpbnRsbigiUGFja2luZyByZWNlaXZlZCBjYWtlOiAiLCBzKQoJfQp9Cg==" }], "Notes": ["note this could be a more advanced preheat story", "Channels: good for", "Mutex good for:\tcaches, state"], "Classes": null, "Styles": null }, { "Number": [39], "Title": "Select", "Elem": [{ "Text": "\n\n\n\u003cpre\u003e\u003cspan num=\"16\"\u003efunc do(task string, duration time.Duration) {\u003c/span\u003e\n\u003cspan num=\"17\"\u003e    fmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\u003c/span\u003e\n\u003cspan num=\"18\"\u003e    wait(duration)\u003c/span\u003e\n\u003cspan num=\"19\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": false, "Edit": false, "FileName": "channel.2.go", "Ext": ".go", "Raw": "ZnVuYyBkbyh0YXNrIHN0cmluZywgZHVyYXRpb24gdGltZS5EdXJhdGlvbikgewoJZm10LlByaW50bG4oIj0+IiwgdGFzaykKCXdhaXQoZHVyYXRpb24pCn0K" }, { "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;runtime\u0026#34;\n\t\u0026#34;time\u0026#34;\n)\n\nconst pace time.Duration = 750\n\nfunc wait(duration time.Duration) {\n\truntime.Gosched() // yield to another goroutine\n\ttime.Sleep(duration * time.Minute / pace)\n}\n\nfunc do(task string, duration time.Duration) {\n\tfmt.Println(\u0026#34;=\u0026gt;\u0026#34;, task)\n\twait(duration)\n}\n\nfunc main() {\n\tstart := time.Now()\n\tcake := make(chan string)\n\tbatter := make(chan bool)\n\tpan := make(chan bool)\n\theat := make(chan int)\n\tgo func() {\n\t\tdo(\u0026#34;grease pan\u0026#34;, 3)\n\t\tpan \u0026lt;- true\n\t}()\n\tgo func() {\n\t\tdo(\u0026#34;mix ingredients\u0026#34;, 15)\n\t\tbatter \u0026lt;- true\n\t}()\n\tgo func() {\n\t\tdo(\u0026#34;preheat\u0026#34;, 18)\n\t\theat \u0026lt;- 350\n\t}()\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"40\"\u003e    go func() {\u003c/span\u003e\n\u003cspan num=\"41\"\u003e        for i := 0; i \u0026lt; 3; i\u0026#43;\u0026#43; {\u003c/span\u003e\n\u003cspan num=\"42\"\u003e            select {\u003c/span\u003e\n\u003cspan num=\"43\"\u003e            case msg1 := \u0026lt;-heat:\u003c/span\u003e\n\u003cspan num=\"44\"\u003e                fmt.Println(\u0026#34;temp is\u0026#34;, msg1)\u003c/span\u003e\n\u003cspan num=\"45\"\u003e            case \u0026lt;-batter:\u003c/span\u003e\n\u003cspan num=\"46\"\u003e                fmt.Println(\u0026#34;batter is ready\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"47\"\u003e            case \u0026lt;-pan:\u003c/span\u003e\n\u003cspan num=\"48\"\u003e                fmt.Println(\u0026#34;pan is ready\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"49\"\u003e            }\u003c/span\u003e\n\u003cspan num=\"50\"\u003e        }\u003c/span\u003e\n\u003cspan num=\"51\"\u003e        do(\u0026#34;bake\u0026#34;, 30)\u003c/span\u003e\n\u003cspan num=\"52\"\u003e        cake \u0026lt;- \u0026#34;fudge cake is ready\u0026#34;\u003c/span\u003e\n\u003cspan num=\"53\"\u003e    }()\u003c/span\u003e\n\u003c/pre\u003e\n\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003e\tfmt.Println(\u0026lt;-cake)\n\tfmt.Println(\u0026#34;baking took\u0026#34;, (time.Since(start) * pace))\n}\n\u003c/span\u003e\u003c/pre\u003e\n", "Play": true, "Edit": false, "FileName": "channel.2.go", "Ext": ".go", "Raw": "CWdvIGZ1bmMoKSB7CgkJZm9yIGkgOj0gMDsgaSA8IDM7IGkrKyB7CgkJCXNlbGVjdCB7CgkJCWNhc2UgbXNnMSA6PSA8LWhlYXQ6CgkJCQlmbXQuUHJpbnRsbigidGVtcCBpcyIsIG1zZzEpCgkJCWNhc2UgPC1iYXR0ZXI6CgkJCQlmbXQuUHJpbnRsbigiYmF0dGVyIGlzIHJlYWR5IikKCQkJY2FzZSA8LXBhbjoKCQkJCWZtdC5QcmludGxuKCJwYW4gaXMgcmVhZHkiKQoJCQl9CgkJfQoJCWRvKCJiYWtlIiwgMzApCgkJY2FrZSA8LSAiZnVkZ2UgY2FrZSBpcyByZWFkeSIKCX0oKQo=" }], "Notes": ["Go’s select lets you wait on multiple channel operations. "], "Classes": null, "Styles": null }, { "Number": [40], "Title": "Which coordination method should you use?", "Elem": [{ "Bullet": ["WaitGroups create barrier events"] }, { "Bullet": ["Mutexes control access to variable state"] }, { "Bullet": ["Channels allow for communication between goroutines"] }], "Notes": ["our example of using one to ensure all goroutines (including the main one) wait before terminating", "good for:\tcaches, state", "passing ownership of data, distributing units of work, communicating async results"], "Classes": null, "Styles": null }, { "Number": [41], "Title": "Deadlocks ", "Elem": null, "Notes": ["a deadlock is a state in which each member of a group is waiting for some other member to take action", "despite the term lock, all of the techniques we discussed for coordination are vulnerable"], "Classes": null, "Styles": null }, { "Number": [42], "Title": "Deadlocks with WaitGroups", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;sync\u0026#34;\n)\n\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"7\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"8\"\u003e    var wg sync.WaitGroup\u003c/span\u003e\n\u003cspan num=\"9\"\u003e    wg.Add(2)\u003c/span\u003e\n\u003cspan num=\"10\"\u003e    wg.Done()\u003c/span\u003e\n\u003cspan num=\"11\"\u003e    wg.Wait()\u003c/span\u003e\n\u003cspan num=\"12\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "deadLockedWaitGroup.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJdmFyIHdnIHN5bmMuV2FpdEdyb3VwCgl3Zy5BZGQoMikKCXdnLkRvbmUoKQoJd2cuV2FpdCgpCn0K" }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [43], "Title": "Deadlocks with locks", "Elem": [{ "Text": "\n\n\n\u003cpre\u003e\u003cspan num=\"10\"\u003efunc funcA() {\u003c/span\u003e\n\u003cspan num=\"11\"\u003e    mu.Lock()\u003c/span\u003e\n\u003cspan num=\"12\"\u003e    fmt.Println(\u0026#34;Hello, World\u0026#34;)\u003c/span\u003e\n\u003cspan num=\"13\"\u003e    mu.Unlock()\u003c/span\u003e\n\u003cspan num=\"14\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": false, "Edit": false, "FileName": "lock.1.go", "Ext": ".go", "Raw": "ZnVuYyBmdW5jQSgpIHsKCW11LkxvY2soKQoJZm10LlByaW50bG4oIkhlbGxvLCBXb3JsZCIpCgltdS5VbmxvY2soKQp9Cg==" }, { "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n\t\u0026#34;sync\u0026#34;\n)\n\nvar mu sync.Mutex\n\nfunc funcA() {\n\tmu.Lock()\n\tfmt.Println(\u0026#34;Hello, World\u0026#34;)\n\tmu.Unlock()\n}\n\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre\u003e\u003cspan num=\"16\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"17\"\u003e    mu.Lock()\u003c/span\u003e\n\u003cspan num=\"18\"\u003e    funcA()\u003c/span\u003e\n\u003cspan num=\"19\"\u003e    mu.Unlock()\u003c/span\u003e\n\u003cspan num=\"20\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": false, "FileName": "lock.1.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJbXUuTG9jaygpCglmdW5jQSgpCgltdS5VbmxvY2soKQp9Cg==" }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [44], "Title": "Deadlocks with channels", "Elem": [{ "Text": "\n\u003cpre style=\"display: none\"\u003e\u003cspan\u003epackage main\n\nimport (\n\t\u0026#34;fmt\u0026#34;\n)\n\n\u003c/span\u003e\u003c/pre\u003e\n\n\u003cpre contenteditable=\"true\" spellcheck=\"false\"\u003e\u003cspan num=\"7\"\u003efunc main() {\u003c/span\u003e\n\u003cspan num=\"9\"\u003e    messages := make(chan string)\u003c/span\u003e\n\u003cspan num=\"10\"\u003e    //sending data\u003c/span\u003e\n\u003cspan num=\"11\"\u003e    messages \u0026lt;- \u0026#34;toast is ready\u0026#34;\u003c/span\u003e\n\u003cspan num=\"12\"\u003e    //receiving data\u003c/span\u003e\n\u003cspan num=\"13\"\u003e    var msg = \u0026lt;-messages\u003c/span\u003e\n\u003cspan num=\"14\"\u003e    fmt.Println(msg)\u003c/span\u003e\n\u003cspan num=\"16\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\n\n\n", "Play": true, "Edit": true, "FileName": "toast.1.go", "Ext": ".go", "Raw": "ZnVuYyBtYWluKCkgewoJbWVzc2FnZXMgOj0gbWFrZShjaGFuIHN0cmluZykKCS8vc2VuZGluZyBkYXRhCgltZXNzYWdlcyA8LSAidG9hc3QgaXMgcmVhZHkiCgkvL3JlY2VpdmluZyBkYXRhCgl2YXIgbXNnID0gPC1tZXNzYWdlcwoJZm10LlByaW50bG4obXNnKQp9Cg==" }], "Notes": null, "Classes": null, "Styles": null }, { "Number": [45], "Title": "Requirements for Deadlocks", "Elem": [{ "Lines": ["Mutual Exclusion", "Hold and Wait", "No preemption", "Circular wait"], "Pre": false }], "Notes": ["in these examples, the deadlocks are somewhat obvious. One of the big advantages to channels is that the way they are used reduces the likelihood that you will introduce a deadlock", "it usually has to do with channel ownership: it's scope is too big, or it's ownership is unclear (who sends and who receives)", "A deadlock situation can arise if all of the following conditions hold simultaneously in a system:", "Mutual exclusion: at least one resource must be held in a non-shareable mode.Only one process can use the resource at any given instant of time.", "Hold and wait or resource holding: a process is currently holding at least one resource and requesting additional resources which are being held by other processes.", "No preemption: a resource can be released only voluntarily by the process holding it.", "Circular wait: a process must be waiting for a resource which is being held by another process, which in turn is waiting for the first process to release the resource. In general, there is a set of waiting processes, P = {P1, P2, …, PN}, such that P1 is waiting for a resource held by P2, P2 is waiting for a resource held by P3 and so on until PN is waiting for a resource held by P1."], "Classes": null, "Styles": null }, { "Number": [46], "Title": "Wrap up", "Elem": [{ "Lines": ["Understanding the concurrent nature of a process can enable parallelism"], "Pre": false }, { "Lines": ["Go provides mechanisms for different styles of concurrency", "have to be conscientious of how we deal with shared state to avoid race conditions and deadlocks"], "Pre": false }], "Notes": ["timing and ordering", "Error handling", "use channel for  struct with result and potential errors"], "Classes": null, "Styles": null }];
    var titleNotes = null
  </script>
  <script src="./assets/notes.js"></script>


  <script>

    if (window["location"] && window["location"]["hostname"] == "talks.golang.org") {
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-11222381-6"]);
      _gaq.push(["b._setAccount", "UA-49880327-6"]);
      window.trackPageview = function () {
        _gaq.push(["_trackPageview", location.pathname + location.hash]);
        _gaq.push(["b._trackPageview", location.pathname + location.hash]);
      };
      window.trackPageview();
      window.trackEvent = function (category, action, opt_label, opt_value, opt_noninteraction) {
        _gaq.push(["_trackEvent", category, action, opt_label, opt_value, opt_noninteraction]);
        _gaq.push(["b._trackEvent", category, action, opt_label, opt_value, opt_noninteraction]);
      };
    }
  </script>
  <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>

<body style="display: none" class="loaded" data-feedly-mini="yes">

  <section class="slides layout-widescreen" style="transform: scale(0.621333);">

    <article class="current">
      <h1>Concurrency in Go</h1>

      <h3>22 September 2018</h3>

      <div class="presenter">


        <p>
          Erin Stanfill
        </p>



        <p>
          Engineer, Truss
        </p>


      </div>

    </article>



    <article class="next">

      <h3>Erin Stanfill</h3>

      <div class="image">
        <img src="./assets/portrait-2.jpg" height="313" width="250">
      </div>

      <div class="image">
        <img src="./assets/truss_logo_grey.jpg">
      </div>


      <p>
        @elstanfill
        <br>

        https://tinyels.github.io/presentations/
      </p>



      <span class="pagenumber">2</span>
    </article>



    <article class="far-next">

      <h3>Agenda</h3>

      <ul>

        <li>what is concurrency</li>

        <li>mechanisms for writing concurrent programs in go</li>

        <li>common errors in concurrent programs</li>

      </ul>


      <span class="pagenumber">3</span>
    </article>



    <article class="">

      <h2>Concurrency is the ability of different parts of a process to be executed out-of-order without affecting the
        final outcome</h2>

      <span class="pagenumber">4</span>
    </article>



    <article class="background" style="background-image: url('./assets/tuxedo-cake.jpg')">

      <span class="pagenumber">5</span>
    </article>



    <article class="">

      <h3>Recipe</h3>

      <div class="image">
        <img src="./assets/fudgecake.jpg">
      </div>


      <span class="pagenumber">6</span>
    </article>



    <article class="">

      <h3>Recipe</h3>

      <div class="image">
        <img src="./assets/sequential-cake-from-recipe.png">
      </div>


      <span class="pagenumber">7</span>
    </article>



    <article class="">

      <h3>Recipe</h3>

      <div class="image">
        <img src="./assets/sequential-cake.png">
      </div>


      <span class="pagenumber">8</span>
    </article>



    <article class="">

      <h3>Recipe</h3>

      <div class="image">
        <img src="./assets/sequential-cake-reordered.png">
      </div>


      <span class="pagenumber">9</span>
    </article>



    <article class="">

      <h3>Recipe </h3>

      <div class="image">
        <img src="./assets/parallel-cake.png">
      </div>


      <span class="pagenumber">10</span>
    </article>



    <article class="">

      <h3>Concurrency vs parallelism</h3>

      <ul>

        <li>concurrency is the composition of independently executing processes</li>

        <li>parallelism is the simultaneous execution of computations</li>

        <li>concurrency can enable parallelism</li>

      </ul>


      <span class="pagenumber">11</span>
    </article>



    <article class="">

      <h3>Benefits of parallelism</h3>

      <ul>

        <li>can complete tasks in less time</li>

        <li>can use available resources more efficiently</li>

      </ul>


      <span class="pagenumber">12</span>
    </article>



    <article class="">

      <h2>Concurrency in Go</h2>

      <span class="pagenumber">13</span>
    </article>



    <article class="">

      <h2>With Go, the developer should take care of concurrency; the Go runtime will take care of parallelism. </h2>

      <span class="pagenumber">14</span>
    </article>



    <article class="">

      <h3>Concurrency in Go</h3>

      <ul>

        <li>creating concurrent tasks (Goroutines)</li>

        <li>coordinating concurrent tasks</li>

        <li>messaging between concurrent tasks</li>

      </ul>


      <span class="pagenumber">15</span>
    </article>



    <article class="">

      <h3>Goroutines</h3>


      <p>
        Goroutines are functions that run concurrently with other functions.
      </p>



      <span class="pagenumber">16</span>
    </article>



    <article class="">

      <h3>Goroutines are not threads</h3>

      <ul>

        <li>many goroutines can be run on one thread</li>

        <li>the scheduler may move a goroutine to other threads</li>

        <li>goroutines use less memory and can start up faster</li>

      </ul>


      <span class="pagenumber">17</span>
    </article>



    <article class="">

      <h3>Goroutine</h3>


      <p>
        A function is run in a goroutine by prefacing the function call with the keyword "go".
      </p>



      <p>
        A sequential snippet of code
      </p>



      <div class="code">
        <pre>preheat()
bake() // doesn't start until preheat has finished</pre>
      </div>



      <p>
        It's concurrent implementation
      </p>



      <div class="code">
        <pre>go preheat()
bake() // doesn't wait for preheat to finish (or start!)</pre>
      </div>



      <span class="pagenumber">18</span>
    </article>



    <article class="">

      <h3>A Serial Cake</h3>

      <div class="code">


        <pre><span num="10">func wait(duration time.Duration) {</span>
<span num="11">    time.Sleep(duration * time.Minute / pace)</span>
<span num="12">}</span>
</pre>


      </div>

      <div class="code">


        <pre><span num="13">func do(task string, duration time.Duration) {</span>
<span num="14">    fmt.Println("=&gt;", task)</span>
<span num="15">    wait(duration)</span>
<span num="16">    fmt.Println("&lt;=", task)</span>
<span num="17">}</span>
</pre>


      </div>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}
func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
	fmt.Println("&lt;=", task)
}
</span></pre>

        <pre><span num="18">func main() {</span>
<span num="19">    start := time.Now()</span>
<span num="20">    do("preheat oven", 18)</span>
<span num="21">    do("Grease pan", 3)</span>
<span num="22">    do("mix ingredients", 15)</span>
<span num="23">    do("bake", 30)</span>
<span num="24">    fmt.Println("baking took", (time.Since(start) * pace))</span>
<span num="25">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">19</span>
    </article>



    <article class="">

      <h3>A Concurrent Cake</h3>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}
func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
	fmt.Println("&lt;=", task)
}
</span></pre>

        <pre><span num="18">func main() {</span>
<span num="19">    start := time.Now()</span>
<span num="20">    <b>go do("preheat oven", 18)</b></span>
<span num="21">    do("Grease pan", 3)      </span>
<span num="22">    do("mix ingredients", 15)</span>
<span num="23">    do("bake", 30)</span>
<span num="24">    fmt.Println("baking took", (time.Since(start) * pace))</span>
<span num="25">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">20</span>
    </article>



    <article class="">

      <h3>Race conditions</h3>

      <div class="image">
        <img src="./assets/raceCondition.png">
      </div>


      <span class="pagenumber">21</span>
    </article>



    <article class="background" style="background-image: url('./assets/bakeoff.png')">

      <span class="pagenumber">22</span>
    </article>



    <article class="">

      <h3>Bake!</h3>

      <div class="code">


        <pre><span num="18">func bakeCake(baker string) {</span>
<span num="19">    fmt.Println(baker, "is starting")</span>
<span num="20">    go do("preheat oven", 18, baker)</span>
<span num="21">    do("Grease pan", 3, baker)</span>
<span num="22">    do("mix ingredients", 15, baker)</span>
<span num="23">    do("bake", 30, baker)</span>
<span num="24">}</span>
</pre>


      </div>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}
func do(task string, duration time.Duration, baker string) {
	fmt.Println(baker, "=&gt;", task)
	wait(duration)
	fmt.Println(baker, "&lt;=", task)
}
func bakeCake(baker string) {
	fmt.Println(baker, "is starting")
	go do("preheat oven", 18, baker)
	do("Grease pan", 3, baker)
	do("mix ingredients", 15, baker)
	do("bake", 30, baker)
}
</span></pre>

        <pre><span num="25">func main() {</span>
<span num="26">    start := time.Now()</span>
<span num="27">    go bakeCake("Nancy")</span>
<span num="28">    go bakeCake("Luis")</span>
<span num="29">    go bakeCake("Martha")</span>
<span num="30">    fmt.Println("baking took", (time.Since(start) * pace))</span>
<span num="31">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">23</span>
    </article>



    <article class="">

      <h2>What just happened?</h2>

      <span class="pagenumber">24</span>
    </article>



    <article class="">

      <h3>main vs goroutines</h3>

      <div class="image">
        <img src="./assets/bake-off.png" height="403" width="950">
      </div>


      <span class="pagenumber">25</span>
    </article>



    <article class="">

      <h3>coordination of goroutines</h3>

      <ul>

        <li>WaitGroups</li>

        <li>Mutex</li>

        <li>Channels</li>

      </ul>


      <span class="pagenumber">26</span>
    </article>



    <article class="">

      <h3>WaitGroup</h3>


      <p>
        A WaitGroup waits for a collection of goroutines to finish. The main goroutine calls Add to set the number of
        goroutines to wait for. Then each of the goroutines runs and calls Done when finished. At the same time, Wait
        can be used to block until all goroutines have finished.
      </p>



      <span class="pagenumber">27</span>
    </article>



    <article class="">

      <h3>Waiting with a WaitGroup</h3>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"sync"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}
func do(task string, duration time.Duration, baker string) {
	fmt.Println(baker, "=&gt;", task)
	wait(duration)
	fmt.Println(baker, "&lt;=", task)
}
func bakeCake(baker string) {
	fmt.Println(baker, "is starting")
	go do("preheat oven", 18, baker)
	do("Grease pan", 3, baker)
	do("mix ingredients", 15, baker)
	do("bake", 30, baker)
}
</span></pre>

        <pre><span num="26">func main() {</span>
<span num="27">    start := time.Now()</span>
<span num="28">    <b>var wg sync.WaitGroup</b></span>
<span num="29">    <b>wg.Add(3)</b></span>
<span num="30">    go func() {</span>
<span num="31">        bakeCake("Nancy")</span>
<span num="32">        <b>wg.Done()</b></span>
<span num="33">    }()</span>
<span num="34">    go func() {</span>
<span num="35">        bakeCake("Luis")</span>
<span num="36">        <b>wg.Done()</b></span>
<span num="37">    }()</span>
<span num="38">    go func() {</span>
<span num="39">        bakeCake("Martha")</span>
<span num="40">        <b>wg.Done()</b></span>
<span num="41">    }()</span>
<span num="42">    <b>wg.Wait()</b></span>
<span num="43">    fmt.Println("baking took", (time.Since(start) * pace))</span>
<span num="44">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">28</span>
    </article>



    <article class="">

      <h3>Be careful with loops and lambdas</h3>


      <p>
        Variables declared in for loops are passed by reference
      </p>


      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"sync"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}
func do(task string, duration time.Duration, baker string) {
	fmt.Println(baker, "=&gt;", task)
	wait(duration)
	fmt.Println(baker, "&lt;=", task)
}
func bakeCake(baker string) {
	fmt.Println(baker, "is starting")
	go do("preheat oven", 18, baker)
	do("Grease pan", 3, baker)
	do("mix ingredients", 15, baker)
	do("bake", 30, baker)
}
</span></pre>

        <pre><span num="26">func main() {</span>
<span num="27">    start := time.Now()</span>
<span num="28">    bakers := []string{"Nancy", "Luis", "Richard", "Chetna", "Martha"}</span>
<span num="29">    var wg sync.WaitGroup</span>
<span num="30">    wg.Add(len(bakers))</span>
<span num="31">    for _, baker := range bakers {</span>
<span num="32">        go func() {</span>
<span num="33">            bakeCake(baker)</span>
<span num="34">            wg.Done()</span>
<span num="35">        }()</span>
<span num="36">    }</span>
<span num="37">    wg.Wait()</span>
<span num="38">    fmt.Println("baking took", (time.Since(start) * pace))</span>
<span num="39">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">29</span>
    </article>



    <article class="">

      <h3>loops and lambdas, con't</h3>


      <p>
        function parameters in Go are passed by value
      </p>


      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"sync"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}
func do(task string, duration time.Duration, baker string) {
	fmt.Println(baker, "=&gt;", task)
	wait(duration)
	fmt.Println(baker, "&lt;=", task)
}
func bakeCake(baker string) {
	fmt.Println(baker, "is starting")
	go do("preheat oven", 18, baker)
	do("Grease pan", 3, baker)
	do("mix ingredients", 15, baker)
	do("bake", 30, baker)
}
</span></pre>

        <pre><span num="26">func main() {</span>
<span num="27">    start := time.Now()</span>
<span num="28">    bakers := []string{"Nancy", "Luis", "Richard", "Chetna", "Martha"}</span>
<span num="29">    var wg sync.WaitGroup</span>
<span num="30">    wg.Add(len(bakers))</span>
<span num="31">    for _, baker := range bakers {</span>
<span num="32">        <b>go func(b string) {</b></span>
<span num="33">            <b>bakeCake(b)</b></span>
<span num="34">            wg.Done()</span>
<span num="35">        <b>}(baker)</b></span>
<span num="36">    }</span>
<span num="37">    wg.Wait()</span>
<span num="38">    fmt.Println("baking took", (time.Since(start) * pace))</span>
<span num="39">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">30</span>
    </article>



    <article class="">

      <h3>Serendipity</h3>

      <div class="code playground" contenteditable="true" spellcheck="false">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}
func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
	fmt.Println("&lt;=", task)
}
</span></pre>

        <pre contenteditable="true" spellcheck="false"><span num="18">func main() {</span>
<span num="19">    start := time.Now()</span>
<span num="20">    go do("preheat oven", 18)</span>
<span num="21">    <b>do("Grease pan", 3)</b></span>
<span num="22">    <b>do("mix ingredients", 15)</b></span>
<span num="23">    do("bake", 30)</span>
<span num="24">    fmt.Println("baking took", (time.Since(start) * pace))</span>
<span num="25">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">31</span>
    </article>



    <article class="background" style="background-image: url('./assets/oven.jpg')">

      <span class="pagenumber">32</span>
    </article>



    <article class="">

      <h3>Locks</h3>

      <div class="code playground" contenteditable="true" spellcheck="false">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"sync"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}

func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
	fmt.Println("&lt;=", task)
}

</span></pre>

        <pre contenteditable="true" spellcheck="false"><span num="22">var oven sync.Mutex</span>
<span num="23"></span>
<span num="24">func useOven(task string, duration time.Duration) {</span>
<span num="25">    oven.Lock()</span>
<span num="26">    do(task, duration)</span>
<span num="27">    oven.Unlock()</span>
<span num="28">}</span>
<span num="29"></span>
<span num="30">func main() {</span>
<span num="31">    start := time.Now()</span>
<span num="32">    go useOven("preheat oven", 18)</span>
<span num="33">    do("Grease pan", 3)</span>
<span num="34">    do("mix ingredients", 15)</span>
<span num="35">    useOven("bake", 30)</span>
<span num="36">    fmt.Println("baking took", (time.Since(start) * pace))</span>
<span num="37">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">33</span>
    </article>



    <article class="">

      <h3>Channels</h3>


      <p>
        Channels are how goroutines communicate with one another
      </p>


      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
)

</span></pre>

        <pre><span num="7">func main() {</span>
<span num="9">    messages := make(chan string)</span>
<span num="10"></span>
<span num="11">    go func() {</span>
<span num="12">        //sending data</span>
<span num="13">        messages &lt;- "toast is ready"</span>
<span num="14">    }()</span>
<span num="15"></span>
<span num="16">    //receiving data</span>
<span num="17">    var msg = &lt;-messages</span>
<span num="18">    fmt.Println(msg)</span>
<span num="20">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">34</span>
    </article>



    <article class="">

      <h3>coordinating with channels</h3>

      <div class="code playground" contenteditable="true" spellcheck="false">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"sync"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}

func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
	fmt.Println("&lt;=", task)
}

func main() {
</span></pre>

        <pre contenteditable="true" spellcheck="false"><span num="23">    start := time.Now()</span>
<span num="24">    var wg sync.WaitGroup</span>
<span num="25">    wg.Add(1)</span>
<span num="26">    heat := make(chan bool)</span>
<span num="27">    go func() {</span>
<span num="28">        do("preheat", 18)</span>
<span num="29">        heat &lt;- true</span>
<span num="30">    }()</span>
<span num="31">    go do("grease pan", 3)</span>
<span num="32">    go do("mix ingredients", 15)</span>
<span num="33">    go func() {</span>
<span num="34">        &lt;-heat</span>
<span num="35">        do("bake", 30)</span>
<span num="36">        wg.Done()</span>
<span num="37">    }()</span>
<span num="38"></span>
<span num="39">    wg.Wait()</span>
<span num="40">    fmt.Println("baking took", (time.Since(start) * pace))</span>
</pre>

        <pre style="display: none"><span>}
</span></pre>
      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">35</span>
    </article>



    <article class="">

      <h3>more conditions</h3>

      <div class="code playground" contenteditable="true" spellcheck="false">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"sync"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	time.Sleep(duration * time.Minute / pace)
}

func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
	fmt.Println("&lt;=", task)
}

func main() {
	start := time.Now()
	var wg sync.WaitGroup
	wg.Add(1)
</span></pre>

        <pre contenteditable="true" spellcheck="false"><span num="26">    heat := make(chan bool)</span>
<span num="27">    batter := make(chan bool)</span>
<span num="28">    pan := make(chan bool)</span>
<span num="29">    go func() {</span>
<span num="30">        &lt;-heat</span>
<span num="31">        &lt;-batter</span>
<span num="32">        &lt;-pan</span>
<span num="33">        do("bake", 30)</span>
<span num="34">        wg.Done()</span>
<span num="35">    }()</span>
<span num="36">    go func() {</span>
<span num="37">        do("preheat", 18)</span>
<span num="38">        heat &lt;- true</span>
<span num="39">    }()</span>
<span num="40">    go func() {</span>
<span num="41">        do("grease pan", 3)</span>
<span num="42">        pan &lt;- true</span>
<span num="43">    }()</span>
<span num="44">    go func() {</span>
<span num="45">        do("mix ingredients", 15)</span>
<span num="46">        batter &lt;- true</span>
<span num="47">    }()</span>
</pre>

        <pre style="display: none"><span>	wg.Wait()
	fmt.Println("baking took", (time.Since(start) * pace))
}
</span></pre>
      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">36</span>
    </article>



    <article class="">

      <h3>waiting on cake</h3>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"runtime"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	runtime.Gosched() // yield to another goroutine
	time.Sleep(duration * time.Minute / pace)
}

func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
	fmt.Println("&lt;=", task)
}

func main() {
	start := time.Now()
	batter := make(chan bool)
	pan := make(chan bool)
	heat := make(chan int)
	go func() {
		do("preheat", 18)
		heat &lt;- 350
	}()
	go func() {
		do("grease pan", 3)
		pan &lt;- true
	}()
	go func() {
		do("mix ingredients", 15)
		batter &lt;- true
	}()
</span></pre>

        <pre><span num="40">    cake := make(chan string)</span>
<span num="41">    go func() {</span>
<span num="42">        &lt;-heat</span>
<span num="43">        &lt;-batter</span>
<span num="44">        &lt;-pan</span>
<span num="45">        do("bake", 30)</span>
<span num="46">        cake &lt;- "fudge cake is ready"</span>
<span num="47">    }()</span>
<span num="48">    fmt.Println(&lt;-cake)</span>
</pre>

        <pre style="display: none"><span>	fmt.Println("baking took", (time.Since(start) * pace))
}
</span></pre>
      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">37</span>
    </article>



    <article class="">

      <h3>handling received data</h3>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"runtime"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	runtime.Gosched() // yield to another goroutine
	time.Sleep(duration * time.Minute / pace)
}

func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
	fmt.Println("&lt;=", task)
}

func main() {
	start := time.Now()
	batter := make(chan bool)
	pan := make(chan bool)
	heat := make(chan int)
	go func() {
		do("preheat", 18)
		heat &lt;- 350
	}()
	go func() {
		do("grease pan", 3)
		pan &lt;- true
	}()
	go func() {
		do("mix ingredients", 15)
		batter &lt;- true
	}()
</span></pre>

        <pre><span num="40">    cake := make(chan string)</span>
<span num="41">    go func() {</span>
<span num="42">        msg1 := &lt;-heat</span>
<span num="43">        fmt.Println("temp is", msg1)</span>
<span num="44">        &lt;-batter</span>
<span num="45">        fmt.Println("batter is ready")</span>
<span num="46">        &lt;-pan</span>
<span num="47">        fmt.Println("pan is ready")</span>
<span num="48">        do("bake", 30)</span>
<span num="49">        cake &lt;- "fudge cake is ready"</span>
<span num="50">    }()</span>
<span num="51">    fmt.Println(&lt;-cake)</span>
</pre>

        <pre style="display: none"><span>	fmt.Println("baking took", (time.Since(start) * pace))
}
</span></pre>
      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">38</span>
    </article>



    <article class="">

      <h3>Range </h3>

      <div class="code">


        <pre><span num="8">func makeCakeAndSend(cs chan string, count int) {</span>
<span num="9">    for i := 1; i &lt;= count; i++ {</span>
<span num="10">        cakeName := "Strawberry Cake " + strconv.Itoa(i)</span>
<span num="11">        cs &lt;- cakeName //send a strawberry cake</span>
<span num="12">    }</span>
<span num="13">    close(cs)</span>
<span num="14">}</span>
</pre>


      </div>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"strconv"
)

func makeCakeAndSend(cs chan string, count int) {
	for i := 1; i &lt;= count; i++ {
		cakeName := "Strawberry Cake " + strconv.Itoa(i)
		cs &lt;- cakeName //send a strawberry cake
	}
	close(cs)
}

</span></pre>

        <pre><span num="16">func main() {</span>
<span num="17">    cs := make(chan string)</span>
<span num="18">    go makeCakeAndSend(cs, 5)</span>
<span num="19">    for s := range cs {</span>
<span num="20">        fmt.Println("Packing received cake: ", s)</span>
<span num="21">    }</span>
<span num="22">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">39</span>
    </article>



    <article class="">

      <h3>Select</h3>

      <div class="code">


        <pre><span num="16">func do(task string, duration time.Duration) {</span>
<span num="17">    fmt.Println("=&gt;", task)</span>
<span num="18">    wait(duration)</span>
<span num="19">}</span>
</pre>


      </div>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"runtime"
	"time"
)

const pace time.Duration = 750

func wait(duration time.Duration) {
	runtime.Gosched() // yield to another goroutine
	time.Sleep(duration * time.Minute / pace)
}

func do(task string, duration time.Duration) {
	fmt.Println("=&gt;", task)
	wait(duration)
}

func main() {
	start := time.Now()
	cake := make(chan string)
	batter := make(chan bool)
	pan := make(chan bool)
	heat := make(chan int)
	go func() {
		do("grease pan", 3)
		pan &lt;- true
	}()
	go func() {
		do("mix ingredients", 15)
		batter &lt;- true
	}()
	go func() {
		do("preheat", 18)
		heat &lt;- 350
	}()
</span></pre>

        <pre><span num="40">    go func() {</span>
<span num="41">        for i := 0; i &lt; 3; i++ {</span>
<span num="42">            select {</span>
<span num="43">            case msg1 := &lt;-heat:</span>
<span num="44">                fmt.Println("temp is", msg1)</span>
<span num="45">            case &lt;-batter:</span>
<span num="46">                fmt.Println("batter is ready")</span>
<span num="47">            case &lt;-pan:</span>
<span num="48">                fmt.Println("pan is ready")</span>
<span num="49">            }</span>
<span num="50">        }</span>
<span num="51">        do("bake", 30)</span>
<span num="52">        cake &lt;- "fudge cake is ready"</span>
<span num="53">    }()</span>
</pre>

        <pre style="display: none"><span>	fmt.Println(&lt;-cake)
	fmt.Println("baking took", (time.Since(start) * pace))
}
</span></pre>
      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">40</span>
    </article>



    <article class="">

      <h3>Which coordination method should you use?</h3>

      <ul>

        <li>WaitGroups create barrier events</li>

      </ul>

      <ul>

        <li>Mutexes control access to variable state</li>

      </ul>

      <ul>

        <li>Channels allow for communication between goroutines</li>

      </ul>


      <span class="pagenumber">41</span>
    </article>



    <article class="">

      <h2>Deadlocks </h2>

      <span class="pagenumber">42</span>
    </article>



    <article class="">

      <h3>Deadlocks with WaitGroups</h3>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"sync"
)

</span></pre>

        <pre><span num="7">func main() {</span>
<span num="8">    var wg sync.WaitGroup</span>
<span num="9">    wg.Add(2)</span>
<span num="10">    wg.Done()</span>
<span num="11">    wg.Wait()</span>
<span num="12">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">43</span>
    </article>



    <article class="">

      <h3>Deadlocks with locks</h3>

      <div class="code">


        <pre><span num="10">func funcA() {</span>
<span num="11">    mu.Lock()</span>
<span num="12">    fmt.Println("Hello, World")</span>
<span num="13">    mu.Unlock()</span>
<span num="14">}</span>
</pre>


      </div>

      <div class="code playground">
        <pre style="display: none"><span>package main

import (
	"fmt"
	"sync"
)

var mu sync.Mutex

func funcA() {
	mu.Lock()
	fmt.Println("Hello, World")
	mu.Unlock()
}

</span></pre>

        <pre><span num="16">func main() {</span>
<span num="17">    mu.Lock()</span>
<span num="18">    funcA()</span>
<span num="19">    mu.Unlock()</span>
<span num="20">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">44</span>
    </article>



    <article class="">

      <h3>Deadlocks with channels</h3>

      <div class="code playground" contenteditable="true" spellcheck="false">
        <pre style="display: none"><span>package main

import (
	"fmt"
)

</span></pre>

        <pre contenteditable="true" spellcheck="false"><span num="7">func main() {</span>
<span num="9">    messages := make(chan string)</span>
<span num="10">    //sending data</span>
<span num="11">    messages &lt;- "toast is ready"</span>
<span num="12">    //receiving data</span>
<span num="13">    var msg = &lt;-messages</span>
<span num="14">    fmt.Println(msg)</span>
<span num="16">}</span>
</pre>


      </div>
      <div class="buttons"><button class="run">Run</button></div>
      <div class="ui-resizable output" style="display: none;">
        <div class="ui-resizable-handle ui-resizable-n" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-w" style="z-index: 90; display: block;"></div>
        <div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90; display: block;"></div>
        <div class="buttons"><button class="run">Run</button><button class="kill">Kill</button><button class="close">Close</button></div>
        <pre></pre>
      </div>


      <span class="pagenumber">45</span>
    </article>



    <article class="">

      <h3>Requirements for Deadlocks</h3>


      <p>
        Mutual Exclusion
        <br>

        Hold and Wait
        <br>

        No preemption
        <br>

        Circular wait
      </p>



      <span class="pagenumber">46</span>
    </article>



    <article class="">

      <h3>Wrap up</h3>


      <p>
        Understanding the concurrent nature of a process can enable parallelism
      </p>



      <p>
        Go provides mechanisms for different styles of concurrency
        <br>

        have to be conscientious of how we deal with shared state to avoid race conditions and deadlocks
      </p>



      <span class="pagenumber">47</span>
    </article>



    <article class="">
      <h3>Thank you</h3>

      <div class="presenter">


        <p>
          Erin Stanfill
        </p>



        <p>
          Engineer, Truss
        </p>

        <p class="link"><a href="mailto:erin@truss.works" target="_blank">erin@truss.works</a></p>
        <p class="link"><a href="http://truss.works/" target="_blank">http://truss.works/</a></p>
        <p class="link"><a href="http://twitter.com/elstanfill" target="_blank">@elstanfill</a></p>
        <p class="link"><a href="https://tinyels.github.io/presentations/" target="_blank">https://tinyels.github.io/presentations/</a></p>
      </div>

    </article>

    <div class="slide-area" id="prev-slide-area"></div>
    <div class="slide-area" id="next-slide-area"></div>
  </section>

  <div id="help" style="display: none;">
    Use the left and right arrow keys or click the left and right
    edges of the page to navigate between slides.<br>
    (Press 'H' or navigate to hide this message.)
  </div>


  <script src="./assets/play.js"></script>


  <script>
    (function () {

      if (window["location"] && window["location"]["hostname"] == "talks.golang.org") {
        var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
        ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
        var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
      }
    })();
  </script>


  <link rel="stylesheet" type="text/css" href="./assets/css">
  <link rel="stylesheet" type="text/css" href="./assets/styles.css">
</body>

</html>